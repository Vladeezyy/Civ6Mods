--------------------
-- Basics
--------------------

INSERT INTO Types
(Type, Kind)
VALUES ('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'KIND_BUILDING');

INSERT INTO Buildings
(BuildingType,
Name,
Description,
PrereqCivic,
Cost,
AdvisorType,
MaxWorldInstances,
IsWonder,
RequiresPlacement,
Entertainment,
AdjacentDistrict,
ObsoleteEra,
Quote)
VALUES ('BUILDING_PHANTA_NOTRE_DAME_SAIGON',
'LOC_BUILDING_PHANTA_NOTRE_DAME_SAIGON_NAME',
'LOC_BUILDING_PHANTA_NOTRE_DAME_SAIGON_DESCRIPTION',
'CIVIC_COLONIALISM',
1240,
'ADVISOR_GENERIC',
1,
1,
1,
2,
'DISTRICT_HOLY_SITE',
'ERA_ATOMIC',
'LOC_BUILDING_PHANTA_NOTRE_DAME_SAIGON_QUOTE');

INSERT INTO Building_RequiredFeatures
(BuildingType, FeatureType)
VALUES ('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'FEATURE_FOREST'),
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'FEATURE_JUNGLE'),
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'FEATURE_MARSH'),
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'FEATURE_FLOODPLAINS'),
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'FEATURE_FLOODPLAINS_PLAINS'),
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'FEATURE_FLOODPLAINS_GRASSLAND');

INSERT INTO Building_YieldChanges
(BuildingType, YieldType, YieldChange)
VALUES ('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'YIELD_CULTURE', 2),
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'YIELD_FAITH', 2);

INSERT INTO Building_GreatWorks
(BuildingType, GreatWorkSlotType, NumSlots)
VALUES ('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'GREATWORKSLOT_CATHEDRAL', 2);

--------------------
-- Requirements
--------------------
INSERT OR REPLACE INTO Requirements
(RequirementId, RequirementType)
VALUES ('PLAYER_HAS_PHANTA_NOTRE_DAME_SAIGON', 'REQUIREMENT_PLAYER_HAS_BUILDING');

INSERT OR REPLACE INTO RequirementArguments
(RequirementId, Name, Value)
VALUES ('PLAYER_HAS_PHANTA_NOTRE_DAME_SAIGON', 'BuildingType', 'BUILDING_PHANTA_NOTRE_DAME_SAIGON');

--------------------
-- RequirementSets
--------------------
INSERT OR REPLACE INTO RequirementSets
(RequirementSetId, RequirementSetType)
VALUES ('REQS_PLAYER_HAS_PNDS', 'REQUIREMENTSET_TEST_ALL');

INSERT OR REPLACE INTO RequirementSetRequirements
(RequirementSetId, RequirementId)
VALUES ('REQS_PLAYER_HAS_PNDS', 'PLAYER_HAS_PHANTA_NOTRE_DAME_SAIGON');

--------------------
-- Bonuses
--------------------

--==== 1.1 Grants Faith

INSERT INTO BuildingModifiers (BuildingType, ModifierId) VALUES
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'MODFEAT_PHANTA_NOTRE_DAME_SAIGON_GRANT_FAITH');

INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODFEAT_PHANTA_NOTRE_DAME_SAIGON_GRANT_FAITH', 'MODIFIER_PLAYER_GRANT_YIELD_BASED_ON_CURRENT_YIELD_RATE', 1, 1, 0, NULL, NULL);

INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODFEAT_PHANTA_NOTRE_DAME_SAIGON_GRANT_FAITH', 'Multiplier', '10'),
('MODFEAT_PHANTA_NOTRE_DAME_SAIGON_GRANT_FAITH', 'YieldToBaseOn', 'YIELD_CULTURE'),
('MODFEAT_PHANTA_NOTRE_DAME_SAIGON_GRANT_FAITH', 'YieldToGrant', 'YIELD_FAITH');

--==== 1.2 Faith purchase districts (with Governor)

INSERT INTO BuildingModifiers (BuildingType, ModifierId) VALUES
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'MODFEAT_PHANTA_NOTRE_DAME_SAIGON_FAITH_PURCHASE_DISTRICTS'),
('BUILDING_PHANTA_NOTRE_DAME_SAIGON', 'MODIFIER_PNDS_CITIES_MODIFIERS');

INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODFEAT_PHANTA_NOTRE_DAME_SAIGON_FAITH_PURCHASE_DISTRICTS', 'MODTYPE_PHANTA_NOTRE_DAME_SAIGON_PLAYER_GOVERNORS_ADJUST_CAN_FAITH_PURCHASE_DISTRICTS', 0, 0, 0, NULL, NULL),
('MODIFIER_PNDS_CITIES_MODIFIERS', 'MODIFIER_PLAYER_CITIES_ATTACH_MODIFIER', 0, 0, 0, NULL, NULL),
('MODIFIER_PNDS_CITY_FAITH_PURCHASE_DISTRICTS', 'MODIFIER_GOVERNOR_ADJUST_CAN_FAITH_PURCHASE_DISTRICTS', 0, 0, 0, NULL, 'CITY_HAS_GOVERNOR'),

('MODIFIER_PNDS_GOV_CITY_FAITH_PURCHASE_DISTRICTS', 'MODIFIER_GOVERNOR_ADJUST_CAN_FAITH_PURCHASE_DISTRICTS', 0, 0, 0, 'REQS_PLAYER_HAS_PNDS', NULL);

INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODFEAT_PHANTA_NOTRE_DAME_SAIGON_FAITH_PURCHASE_DISTRICTS', 'CanPurchase', 'true'),
('MODIFIER_PNDS_CITY_FAITH_PURCHASE_DISTRICTS', 'CanPurchase', 'true'),
('MODIFIER_PNDS_GOV_CITY_FAITH_PURCHASE_DISTRICTS', 'CanPurchase', 'true'),
('MODIFIER_PNDS_CITIES_MODIFIERS', 'ModifierId', 'MODIFIER_PNDS_CITY_FAITH_PURCHASE_DISTRICTS');

-- Custom ModifierType

INSERT INTO Types (Type, Kind) VALUES
('MODTYPE_PHANTA_NOTRE_DAME_SAIGON_PLAYER_GOVERNORS_ADJUST_CAN_FAITH_PURCHASE_DISTRICTS', 'KIND_MODIFIER');

INSERT INTO DynamicModifiers (ModifierType, CollectionType, EffectType) VALUES
('MODTYPE_PHANTA_NOTRE_DAME_SAIGON_PLAYER_GOVERNORS_ADJUST_CAN_FAITH_PURCHASE_DISTRICTS', 'COLLECTION_PLAYER_GOVERNORS', 'EFFECT_ADJUST_CAN_FAITH_PURCHASE_DISTRICTS');

-- Governor Promotion Register Trigger
-- By Luminous
-- More stable Realization: Bind the faith purchasing modifier onto ALL Governor titles
CREATE TABLE GovPromotionList(
'GovernorPromotion' TEXT NOT NULL
);

INSERT OR REPLACE INTO GovPromotionList
(GovernorPromotion)
SELECT DISTINCT GovernorPromotion
FROM GovernorPromotionSets;
-- WHERE Kind = 'KIND_GOVERNOR_PROMOTION';

INSERT OR REPLACE INTO GovernorPromotionModifiers
(GovernorPromotionType, ModifierId)
SELECT GovernorPromotion, 'MODIFIER_PNDS_GOV_CITY_FAITH_PURCHASE_DISTRICTS'
FROM GovPromotionList;

-- Catch Custom Govornors from expansion mods
CREATE TRIGGER GovernorPromotionReg
AFTER INSERT ON GovernorPromotionSets
WHEN NEW.GovernorPromotion NOT NULL
BEGIN
INSERT OR REPLACE INTO GovPromotionList(GovernorPromotion)
VALUES (NEW.GovernorPromotion);

INSERT OR REPLACE INTO GovernorPromotionModifiers(GovernorPromotionType, ModifierId)
VALUES (NEW.GovernorPromotion, 'MODIFIER_PNDS_GOV_CITY_FAITH_PURCHASE_DISTRICTS');
END;