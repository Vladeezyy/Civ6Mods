--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
-- INCLUDES
--==========================================================================================================================

--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
print("Angkor Wat Rework Gameplay Functions Loaded")
--==========================================================================================================================
-- Variables
--==========================================================================================================================

local iBuilding = "BUILDING_ANGKOR_WAT"
-- Values





--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
--<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
--==========================================================================================================================
--==========================================================================================================================
-- UTILITY FUNCTIONS
--==========================================================================================================================
-- UTILS
----------------------------------------------------------------------------------------------------------------------------
iMod = (GameInfo.GameSpeeds[GameConfiguration.GetGameSpeedType()].CostMultiplier)/100;


--==========================================================================================================================
-- CORE FUNCTIONS
--==========================================================================================================================
---------------------------------------------------------
-- Property on Local Owned Trading Posts
---------------------------------------------------------

function Leu_LocalOwnedTradingPostProperty(playerID, params)
	---- PARAMETERS:
	---- parameters.playerID
	---- parameters.Leu_CityName
	---- parameters.Leu_CityX
	---- parameters.Leu_CityY

	local pPlayer = Players[params.playerID]
	--print("Setting the property")
	--
	local pCity = CityManager.GetCityAt(params.Leu_CityX, params.Leu_CityY)
	local pPlot = Map.GetPlot(params.Leu_CityX, params.Leu_CityY);
	pPlot:SetProperty( "LeuHasOwnedTradePost", 1 ) 
	--
end

GameEvents.Leu_LocalOwnedTradingPostProperty.Add(Leu_LocalOwnedTradingPostProperty)

function Leu_CheckAngkoredCities(playerID, params)
	---- PARAMETERS:
	---- parameters.playerID = playerID;
	---- parameters.Leu_CityX = iCityX;
	---- parameters.Leu_CityY = iCityY;
	---- parameters.Leu_IsAngkored = AngkoredWat
	local pPlayer = Players[params.playerID]
	if params.Leu_IsAngkored == 1 then
	print("Setting the Mutual Angkor Trade property")
	end
	--
	local pCity = CityManager.GetCityAt(params.Leu_CityX, params.Leu_CityY)
	local pPlot = Map.GetPlot(params.Leu_CityX, params.Leu_CityY);
	pPlot:SetProperty("LeuAngkorTrade", params.Leu_IsAngkored ) 
	--
end

GameEvents.Leu_CheckAngkoredCities.Add(Leu_CheckAngkoredCities)



function Leu_OnAngkorWatCompleted( locX, locY, buildingIndex, playerIndex, cityId, iPercentComplete, pillaged)

	if (GameInfo.Buildings[buildingIndex].RequiresPlacement and iPercentComplete == 100) then
		local currentBuildingType :string = GameInfo.Buildings[buildingIndex].BuildingType;
		if currentBuildingType == iBuilding then			
			print("AngkorWat was built this turn")
			local pCity	 = CityManager.GetCity(playerIndex, cityId);
			local iCityX = pCity:GetX();
			local iCityY = pCity:GetY();
			local pPlot = Map.GetPlot(iCityX, iCityY);
			pPlot:SetProperty( "LeuHasAngkor", 1 ) 
		end
	end
end

Events.WonderCompleted.Add(Leu_OnAngkorWatCompleted)




--==========================================================================================================================
--==========================================================================================================================